{"version":3,"file":"use-focus-trap.esm.js","sources":["../../src/hooks/use-focus-trap.ts"],"sourcesContent":["import {\n  onUnmounted,\n  onUpdated,\n  ref,\n  watchEffect,\n\n  // Types\n  Ref,\n} from 'vue'\n\nimport { Keys } from '../keyboard'\nimport { focusElement, focusIn, Focus, FocusResult } from '../utils/focus-management'\nimport { useWindowEvent } from '../hooks/use-window-event'\nimport { contains } from '../internal/dom-containers'\n\nexport function useFocusTrap(\n  containers: Ref<Set<HTMLElement>>,\n  enabled: Ref<boolean> = ref(true),\n  options: Ref<{ initialFocus?: HTMLElement | null }> = ref({})\n) {\n  let restoreElement = ref<HTMLElement | null>(\n    typeof window !== 'undefined' ? (document.activeElement as HTMLElement) : null\n  )\n  let previousActiveElement = ref<HTMLElement | null>(null)\n\n  function handleFocus() {\n    if (!enabled.value) return\n    if (containers.value.size !== 1) return\n    let { initialFocus } = options.value\n\n    let activeElement = document.activeElement as HTMLElement\n\n    if (initialFocus) {\n      if (initialFocus === activeElement) {\n        return // Initial focus ref is already the active element\n      }\n    } else if (contains(containers.value, activeElement)) {\n      return // Already focused within Dialog\n    }\n\n    restoreElement.value = activeElement\n\n    // Try to focus the initialFocus ref\n    if (initialFocus) {\n      focusElement(initialFocus)\n    } else {\n      let couldFocus = false\n      for (let container of containers.value) {\n        let result = focusIn(container, Focus.First)\n        if (result === FocusResult.Success) {\n          couldFocus = true\n          break\n        }\n      }\n\n      if (!couldFocus) console.warn('There are no focusable elements inside the <FocusTrap />')\n    }\n\n    previousActiveElement.value = document.activeElement as HTMLElement\n  }\n\n  // Restore when `enabled` becomes false\n  function restore() {\n    focusElement(restoreElement.value)\n    restoreElement.value = null\n    previousActiveElement.value = null\n  }\n\n  // Handle initial focus\n  watchEffect(handleFocus)\n\n  onUpdated(() => {\n    enabled.value ? handleFocus() : restore()\n  })\n  onUnmounted(restore)\n\n  // Handle Tab & Shift+Tab keyboard events\n  useWindowEvent('keydown', event => {\n    if (!enabled.value) return\n    if (event.key !== Keys.Tab) return\n    if (!document.activeElement) return\n    if (containers.value.size !== 1) return\n\n    event.preventDefault()\n\n    for (let element of containers.value) {\n      let result = focusIn(\n        element,\n        (event.shiftKey ? Focus.Previous : Focus.Next) | Focus.WrapAround\n      )\n\n      if (result === FocusResult.Success) {\n        previousActiveElement.value = document.activeElement as HTMLElement\n        break\n      }\n    }\n  })\n\n  // Prevent programmatically escaping\n  useWindowEvent(\n    'focus',\n    event => {\n      if (!enabled.value) return\n      if (containers.value.size !== 1) return\n\n      let previous = previousActiveElement.value\n      if (!previous) return\n\n      let toElement = event.target as HTMLElement | null\n\n      if (toElement && toElement instanceof HTMLElement) {\n        if (!contains(containers.value, toElement)) {\n          event.preventDefault()\n          event.stopPropagation()\n          focusElement(previous)\n        } else {\n          previousActiveElement.value = toElement\n          focusElement(toElement)\n        }\n      } else {\n        focusElement(previousActiveElement.value)\n      }\n    },\n    true\n  )\n}\n"],"names":["useFocusTrap","containers","enabled","options","ref","restoreElement","window","document","activeElement","previousActiveElement","handleFocus","value","size","initialFocus","contains","focusElement","couldFocus","container","result","focusIn","Focus","First","FocusResult","Success","console","warn","restore","watchEffect","onUpdated","onUnmounted","useWindowEvent","event","key","Keys","Tab","preventDefault","element","shiftKey","Previous","Next","WrapAround","previous","toElement","target","HTMLElement","stopPropagation"],"mappings":";;;;;;;SAegBA,aACdC,YACAC,SACAC;MADAD;AAAAA,IAAAA,UAAwBE,GAAG,CAAC,IAAD;;;MAC3BD;AAAAA,IAAAA,UAAsDC,GAAG,CAAC,EAAD;;;AAEzD,MAAIC,cAAc,GAAGD,GAAG,CACtB,OAAOE,MAAP,KAAkB,WAAlB,GAAiCC,QAAQ,CAACC,aAA1C,GAA0E,IADpD,CAAxB;AAGA,MAAIC,qBAAqB,GAAGL,GAAG,CAAqB,IAArB,CAA/B;;AAEA,WAASM,WAAT;AACE,QAAI,CAACR,OAAO,CAACS,KAAb,EAAoB;AACpB,QAAIV,UAAU,CAACU,KAAX,CAAiBC,IAAjB,KAA0B,CAA9B,EAAiC;QAC3BC,eAAiBV,OAAO,CAACQ,MAAzBE;AAEN,QAAIL,aAAa,GAAGD,QAAQ,CAACC,aAA7B;;AAEA,QAAIK,YAAJ,EAAkB;AAChB,UAAIA,YAAY,KAAKL,aAArB,EAAoC;AAClC,eADkC;AAEnC;AACF,KAJD,MAIO,IAAIM,QAAQ,CAACb,UAAU,CAACU,KAAZ,EAAmBH,aAAnB,CAAZ,EAA+C;AACpD,aADoD;AAErD;;AAEDH,IAAAA,cAAc,CAACM,KAAf,GAAuBH,aAAvB;;AAGA,QAAIK,YAAJ,EAAkB;AAChBE,MAAAA,YAAY,CAACF,YAAD,CAAZ;AACD,KAFD,MAEO;AACL,UAAIG,UAAU,GAAG,KAAjB;;AACA,2DAAsBf,UAAU,CAACU,KAAjC,wCAAwC;AAAA,YAA/BM,SAA+B;AACtC,YAAIC,MAAM,GAAGC,OAAO,CAACF,SAAD,EAAYG,KAAK,CAACC,KAAlB,CAApB;;AACA,YAAIH,MAAM,KAAKI,WAAW,CAACC,OAA3B,EAAoC;AAClCP,UAAAA,UAAU,GAAG,IAAb;AACA;AACD;AACF;;AAED,UAAI,CAACA,UAAL,EAAiBQ,OAAO,CAACC,IAAR,CAAa,0DAAb;AAClB;;AAEDhB,IAAAA,qBAAqB,CAACE,KAAtB,GAA8BJ,QAAQ,CAACC,aAAvC;AACD;;;AAGD,WAASkB,OAAT;AACEX,IAAAA,YAAY,CAACV,cAAc,CAACM,KAAhB,CAAZ;AACAN,IAAAA,cAAc,CAACM,KAAf,GAAuB,IAAvB;AACAF,IAAAA,qBAAqB,CAACE,KAAtB,GAA8B,IAA9B;AACD;;;AAGDgB,EAAAA,WAAW,CAACjB,WAAD,CAAX;AAEAkB,EAAAA,SAAS,CAAC;AACR1B,IAAAA,OAAO,CAACS,KAAR,GAAgBD,WAAW,EAA3B,GAAgCgB,OAAO,EAAvC;AACD,GAFQ,CAAT;AAGAG,EAAAA,WAAW,CAACH,OAAD,CAAX;;AAGAI,EAAAA,cAAc,CAAC,SAAD,EAAY,UAAAC,KAAK;AAC7B,QAAI,CAAC7B,OAAO,CAACS,KAAb,EAAoB;AACpB,QAAIoB,KAAK,CAACC,GAAN,KAAcC,IAAI,CAACC,GAAvB,EAA4B;AAC5B,QAAI,CAAC3B,QAAQ,CAACC,aAAd,EAA6B;AAC7B,QAAIP,UAAU,CAACU,KAAX,CAAiBC,IAAjB,KAA0B,CAA9B,EAAiC;AAEjCmB,IAAAA,KAAK,CAACI,cAAN;;AAEA,0DAAoBlC,UAAU,CAACU,KAA/B,2CAAsC;AAAA,UAA7ByB,OAA6B;AACpC,UAAIlB,MAAM,GAAGC,OAAO,CAClBiB,OADkB,EAElB,CAACL,KAAK,CAACM,QAAN,GAAiBjB,KAAK,CAACkB,QAAvB,GAAkClB,KAAK,CAACmB,IAAzC,IAAiDnB,KAAK,CAACoB,UAFrC,CAApB;;AAKA,UAAItB,MAAM,KAAKI,WAAW,CAACC,OAA3B,EAAoC;AAClCd,QAAAA,qBAAqB,CAACE,KAAtB,GAA8BJ,QAAQ,CAACC,aAAvC;AACA;AACD;AACF;AACF,GAnBa,CAAd;;AAsBAsB,EAAAA,cAAc,CACZ,OADY,EAEZ,UAAAC,KAAK;AACH,QAAI,CAAC7B,OAAO,CAACS,KAAb,EAAoB;AACpB,QAAIV,UAAU,CAACU,KAAX,CAAiBC,IAAjB,KAA0B,CAA9B,EAAiC;AAEjC,QAAI6B,QAAQ,GAAGhC,qBAAqB,CAACE,KAArC;AACA,QAAI,CAAC8B,QAAL,EAAe;AAEf,QAAIC,SAAS,GAAGX,KAAK,CAACY,MAAtB;;AAEA,QAAID,SAAS,IAAIA,SAAS,YAAYE,WAAtC,EAAmD;AACjD,UAAI,CAAC9B,QAAQ,CAACb,UAAU,CAACU,KAAZ,EAAmB+B,SAAnB,CAAb,EAA4C;AAC1CX,QAAAA,KAAK,CAACI,cAAN;AACAJ,QAAAA,KAAK,CAACc,eAAN;AACA9B,QAAAA,YAAY,CAAC0B,QAAD,CAAZ;AACD,OAJD,MAIO;AACLhC,QAAAA,qBAAqB,CAACE,KAAtB,GAA8B+B,SAA9B;AACA3B,QAAAA,YAAY,CAAC2B,SAAD,CAAZ;AACD;AACF,KATD,MASO;AACL3B,MAAAA,YAAY,CAACN,qBAAqB,CAACE,KAAvB,CAAZ;AACD;AACF,GAvBW,EAwBZ,IAxBY,CAAd;AA0BD;;;;"}