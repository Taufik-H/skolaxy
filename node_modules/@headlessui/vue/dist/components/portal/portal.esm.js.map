{"version":3,"file":"portal.esm.js","sources":["../../../src/components/portal/portal.ts"],"sourcesContent":["import {\n  Teleport,\n  defineComponent,\n  h,\n  inject,\n  onUnmounted,\n  provide,\n  reactive,\n  ref,\n  watchEffect,\n\n  // Types\n  InjectionKey,\n  PropType,\n} from 'vue'\nimport { render } from '../../utils/render'\nimport { useElemenStack, useStackProvider } from '../../internal/stack-context'\nimport { usePortalRoot } from '../../internal/portal-force-root'\n\n// ---\n\nfunction getPortalRoot() {\n  let existingRoot = document.getElementById('headlessui-portal-root')\n  if (existingRoot) return existingRoot\n\n  let root = document.createElement('div')\n  root.setAttribute('id', 'headlessui-portal-root')\n  return document.body.appendChild(root)\n}\n\nexport let Portal = defineComponent({\n  name: 'Portal',\n  props: {\n    as: { type: [Object, String], default: 'div' },\n  },\n  setup(props, { slots, attrs }) {\n    let forcePortalRoot = usePortalRoot()\n    let groupContext = inject(PortalGroupContext, null)\n    let myTarget = ref(\n      forcePortalRoot === true\n        ? getPortalRoot()\n        : groupContext === null\n        ? getPortalRoot()\n        : groupContext.resolveTarget()\n    )\n\n    watchEffect(() => {\n      if (forcePortalRoot) return\n      if (groupContext === null) return\n      myTarget.value = groupContext.resolveTarget()\n    })\n\n    let element = ref(null)\n    useElemenStack(element)\n\n    onUnmounted(() => {\n      let root = document.getElementById('headlessui-portal-root')\n      if (!root) return\n      if (myTarget.value !== root) return\n\n      if (myTarget.value.children.length <= 0) {\n        myTarget.value.parentElement?.removeChild(myTarget.value)\n      }\n    })\n\n    useStackProvider()\n\n    return () => {\n      if (myTarget.value === null) return null\n\n      let propsWeControl = {\n        ref: element,\n      }\n\n      return h(\n        // @ts-expect-error Children can be an object, but TypeScript is not happy\n        // with it. Once this is fixed upstream we can remove this assertion.\n        Teleport,\n        { to: myTarget.value },\n        render({\n          props: { ...props, ...propsWeControl },\n          slot: {},\n          attrs,\n          slots,\n          name: 'Portal',\n        })\n      )\n    }\n  },\n})\n\n// ---\n\nlet PortalGroupContext = Symbol('PortalGroupContext') as InjectionKey<{\n  resolveTarget(): HTMLElement | null\n}>\n\nexport let PortalGroup = defineComponent({\n  name: 'PortalGroup',\n  props: {\n    as: { type: [Object, String], default: 'template' },\n    target: { type: Object as PropType<HTMLElement | null>, default: null },\n  },\n  setup(props, { attrs, slots }) {\n    let api = reactive({\n      resolveTarget() {\n        return props.target\n      },\n    })\n\n    provide(PortalGroupContext, api)\n\n    return () => {\n      let { target: _, ...passThroughProps } = props\n\n      return render({ props: passThroughProps, slot: {}, attrs, slots, name: 'PortalGroup' })\n    }\n  },\n})\n"],"names":["getPortalRoot","existingRoot","document","getElementById","root","createElement","setAttribute","body","appendChild","Portal","defineComponent","name","props","as","type","Object","String","setup","slots","attrs","forcePortalRoot","usePortalRoot","groupContext","inject","PortalGroupContext","myTarget","ref","resolveTarget","watchEffect","value","element","useElemenStack","onUnmounted","children","length","parentElement","removeChild","useStackProvider","propsWeControl","h","Teleport","to","render","slot","Symbol","PortalGroup","target","api","reactive","provide","passThroughProps"],"mappings":"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"}