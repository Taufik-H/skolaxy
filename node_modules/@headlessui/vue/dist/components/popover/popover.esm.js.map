{"version":3,"file":"popover.esm.js","sources":["../../../src/components/popover/popover.ts"],"sourcesContent":["import {\n  defineComponent,\n  inject,\n  onUnmounted,\n  provide,\n  ref,\n  watchEffect,\n\n  // Types\n  InjectionKey,\n  Ref,\n  computed,\n} from 'vue'\n\nimport { match } from '../../utils/match'\nimport { render, Features } from '../../utils/render'\nimport { useId } from '../../hooks/use-id'\nimport { Keys } from '../../keyboard'\nimport {\n  getFocusableElements,\n  Focus,\n  focusIn,\n  FocusResult,\n  isFocusableElement,\n  FocusableMode,\n} from '../../utils/focus-management'\nimport { dom } from '../../utils/dom'\nimport { useWindowEvent } from '../../hooks/use-window-event'\nimport { useOpenClosedProvider, State, useOpenClosed } from '../../internal/open-closed'\nimport { useResolveButtonType } from '../../hooks/use-resolve-button-type'\n\nenum PopoverStates {\n  Open,\n  Closed,\n}\n\ninterface StateDefinition {\n  // State\n  popoverState: Ref<PopoverStates>\n  button: Ref<HTMLElement | null>\n  buttonId: string\n  panel: Ref<HTMLElement | null>\n  panelId: string\n\n  // State mutators\n  togglePopover(): void\n  closePopover(): void\n\n  // Exposed functions\n  close(focusableElement: HTMLElement | Ref<HTMLElement | null>): void\n}\n\nlet PopoverContext = Symbol('PopoverContext') as InjectionKey<StateDefinition>\nfunction usePopoverContext(component: string) {\n  let context = inject(PopoverContext, null)\n  if (context === null) {\n    let err = new Error(`<${component} /> is missing a parent <${Popover.name} /> component.`)\n    if (Error.captureStackTrace) Error.captureStackTrace(err, usePopoverContext)\n    throw err\n  }\n  return context\n}\n\nlet PopoverGroupContext = Symbol('PopoverGroupContext') as InjectionKey<{\n  registerPopover(registerbag: PopoverRegisterBag): void\n  unregisterPopover(registerbag: PopoverRegisterBag): void\n  isFocusWithinPopoverGroup(): boolean\n  closeOthers(buttonId: string): void\n} | null>\n\nfunction usePopoverGroupContext() {\n  return inject(PopoverGroupContext, null)\n}\n\nlet PopoverPanelContext = Symbol('PopoverPanelContext') as InjectionKey<string | null>\nfunction usePopoverPanelContext() {\n  return inject(PopoverPanelContext, null)\n}\n\ninterface PopoverRegisterBag {\n  buttonId: string\n  panelId: string\n  close(): void\n}\n\n// ---\n\nexport let Popover = defineComponent({\n  name: 'Popover',\n  props: {\n    as: { type: [Object, String], default: 'div' },\n  },\n  setup(props, { slots, attrs }) {\n    let buttonId = `headlessui-popover-button-${useId()}`\n    let panelId = `headlessui-popover-panel-${useId()}`\n\n    let popoverState = ref<StateDefinition['popoverState']['value']>(PopoverStates.Closed)\n    let button = ref<StateDefinition['button']['value']>(null)\n    let panel = ref<StateDefinition['panel']['value']>(null)\n\n    let api = {\n      popoverState,\n      buttonId,\n      panelId,\n      panel,\n      button,\n      togglePopover() {\n        popoverState.value = match(popoverState.value, {\n          [PopoverStates.Open]: PopoverStates.Closed,\n          [PopoverStates.Closed]: PopoverStates.Open,\n        })\n      },\n      closePopover() {\n        if (popoverState.value === PopoverStates.Closed) return\n        popoverState.value = PopoverStates.Closed\n      },\n      close(focusableElement: HTMLElement | Ref<HTMLElement | null>) {\n        api.closePopover()\n\n        let restoreElement = (() => {\n          if (!focusableElement) return dom(api.button)\n          if (focusableElement instanceof HTMLElement) return focusableElement\n          if (focusableElement.value instanceof HTMLElement) return dom(focusableElement)\n\n          return dom(api.button)\n        })()\n\n        restoreElement?.focus()\n      },\n    } as StateDefinition\n\n    provide(PopoverContext, api)\n    useOpenClosedProvider(\n      computed(() =>\n        match(popoverState.value, {\n          [PopoverStates.Open]: State.Open,\n          [PopoverStates.Closed]: State.Closed,\n        })\n      )\n    )\n\n    let registerBag = {\n      buttonId,\n      panelId,\n      close() {\n        api.closePopover()\n      },\n    }\n\n    let groupContext = usePopoverGroupContext()\n    let registerPopover = groupContext?.registerPopover\n\n    function isFocusWithinPopoverGroup() {\n      return (\n        groupContext?.isFocusWithinPopoverGroup() ??\n        (dom(button)?.contains(document.activeElement) ||\n          dom(panel)?.contains(document.activeElement))\n      )\n    }\n\n    watchEffect(() => registerPopover?.(registerBag))\n\n    // Handle focus out\n    useWindowEvent(\n      'focus',\n      () => {\n        if (popoverState.value !== PopoverStates.Open) return\n        if (isFocusWithinPopoverGroup()) return\n        if (!button) return\n        if (!panel) return\n\n        api.closePopover()\n      },\n      true\n    )\n\n    // Handle outside click\n    useWindowEvent('mousedown', (event: MouseEvent) => {\n      let target = event.target as HTMLElement\n\n      if (popoverState.value !== PopoverStates.Open) return\n\n      if (dom(button)?.contains(target)) return\n      if (dom(panel)?.contains(target)) return\n\n      api.closePopover()\n\n      if (!isFocusableElement(target, FocusableMode.Loose)) {\n        event.preventDefault()\n        dom(button)?.focus()\n      }\n    })\n\n    return () => {\n      let slot = { open: popoverState.value === PopoverStates.Open, close: api.close }\n      return render({ props, slot, slots, attrs, name: 'Popover' })\n    }\n  },\n})\n\n// ---\n\nexport let PopoverButton = defineComponent({\n  name: 'PopoverButton',\n  props: {\n    as: { type: [Object, String], default: 'button' },\n    disabled: { type: [Boolean], default: false },\n  },\n  render() {\n    let api = usePopoverContext('PopoverButton')\n\n    let slot = { open: api.popoverState.value === PopoverStates.Open }\n    let propsWeControl = this.isWithinPanel\n      ? {\n          ref: 'el',\n          type: this.type,\n          onKeydown: this.handleKeyDown,\n          onClick: this.handleClick,\n        }\n      : {\n          ref: 'el',\n          id: api.buttonId,\n          type: this.type,\n          'aria-expanded': this.$props.disabled\n            ? undefined\n            : api.popoverState.value === PopoverStates.Open,\n          'aria-controls': dom(api.panel) ? api.panelId : undefined,\n          disabled: this.$props.disabled ? true : undefined,\n          onKeydown: this.handleKeyDown,\n          onKeyup: this.handleKeyUp,\n          onClick: this.handleClick,\n        }\n\n    return render({\n      props: { ...this.$props, ...propsWeControl },\n      slot,\n      attrs: this.$attrs,\n      slots: this.$slots,\n      name: 'PopoverButton',\n    })\n  },\n  setup(props, { attrs }) {\n    let api = usePopoverContext('PopoverButton')\n\n    let groupContext = usePopoverGroupContext()\n    let closeOthers = groupContext?.closeOthers\n\n    let panelContext = usePopoverPanelContext()\n    let isWithinPanel = panelContext === null ? false : panelContext === api.panelId\n\n    // TODO: Revisit when handling Tab/Shift+Tab when using Portal's\n    let activeElementRef = ref<Element | null>(null)\n    let previousActiveElementRef = ref<Element | null>(\n      typeof window === 'undefined' ? null : document.activeElement\n    )\n\n    useWindowEvent(\n      'focus',\n      () => {\n        previousActiveElementRef.value = activeElementRef.value\n        activeElementRef.value = document.activeElement\n      },\n      true\n    )\n\n    let elementRef = ref(null)\n\n    if (!isWithinPanel) {\n      watchEffect(() => {\n        api.button.value = elementRef.value\n      })\n    }\n\n    return {\n      isWithinPanel,\n      el: elementRef,\n      type: useResolveButtonType(\n        computed(() => ({ as: props.as, type: attrs.type })),\n        elementRef\n      ),\n      handleKeyDown(event: KeyboardEvent) {\n        if (isWithinPanel) {\n          if (api.popoverState.value === PopoverStates.Closed) return\n          switch (event.key) {\n            case Keys.Space:\n            case Keys.Enter:\n              event.preventDefault() // Prevent triggering a *click* event\n              event.stopPropagation()\n              api.closePopover()\n              dom(api.button)?.focus() // Re-focus the original opening Button\n              break\n          }\n        } else {\n          switch (event.key) {\n            case Keys.Space:\n            case Keys.Enter:\n              event.preventDefault() // Prevent triggering a *click* event\n              event.stopPropagation()\n              if (api.popoverState.value === PopoverStates.Closed) closeOthers?.(api.buttonId)\n              api.togglePopover()\n              break\n\n            case Keys.Escape:\n              if (api.popoverState.value !== PopoverStates.Open) return closeOthers?.(api.buttonId)\n              if (!dom(api.button)) return\n              if (!dom(api.button)?.contains(document.activeElement)) return\n              event.preventDefault()\n              event.stopPropagation()\n              api.closePopover()\n              break\n\n            case Keys.Tab:\n              if (api.popoverState.value !== PopoverStates.Open) return\n              if (!api.panel) return\n              if (!api.button) return\n\n              // TODO: Revisit when handling Tab/Shift+Tab when using Portal's\n              if (event.shiftKey) {\n                // Check if the last focused element exists, and check that it is not inside button or panel itself\n                if (!previousActiveElementRef.value) return\n                if (dom(api.button)?.contains(previousActiveElementRef.value)) return\n                if (dom(api.panel)?.contains(previousActiveElementRef.value)) return\n\n                // Check if the last focused element is *after* the button in the DOM\n                let focusableElements = getFocusableElements()\n                let previousIdx = focusableElements.indexOf(\n                  previousActiveElementRef.value as HTMLElement\n                )\n                let buttonIdx = focusableElements.indexOf(dom(api.button)!)\n                if (buttonIdx > previousIdx) return\n\n                event.preventDefault()\n                event.stopPropagation()\n\n                focusIn(dom(api.panel)!, Focus.Last)\n              } else {\n                event.preventDefault()\n                event.stopPropagation()\n\n                focusIn(dom(api.panel)!, Focus.First)\n              }\n\n              break\n          }\n        }\n      },\n      handleKeyUp(event: KeyboardEvent) {\n        if (isWithinPanel) return\n        if (event.key === Keys.Space) {\n          // Required for firefox, event.preventDefault() in handleKeyDown for\n          // the Space key doesn't cancel the handleKeyUp, which in turn\n          // triggers a *click*.\n          event.preventDefault()\n        }\n        if (api.popoverState.value !== PopoverStates.Open) return\n        if (!api.panel) return\n        if (!api.button) return\n\n        // TODO: Revisit when handling Tab/Shift+Tab when using Portal's\n        switch (event.key) {\n          case Keys.Tab:\n            // Check if the last focused element exists, and check that it is not inside button or panel itself\n            if (!previousActiveElementRef.value) return\n            if (dom(api.button)?.contains(previousActiveElementRef.value)) return\n            if (dom(api.panel)?.contains(previousActiveElementRef.value)) return\n\n            // Check if the last focused element is *after* the button in the DOM\n            let focusableElements = getFocusableElements()\n            let previousIdx = focusableElements.indexOf(\n              previousActiveElementRef.value as HTMLElement\n            )\n            let buttonIdx = focusableElements.indexOf(dom(api.button)!)\n            if (buttonIdx > previousIdx) return\n\n            event.preventDefault()\n            event.stopPropagation()\n            focusIn(dom(api.panel)!, Focus.Last)\n            break\n        }\n      },\n      handleClick() {\n        if (props.disabled) return\n        if (isWithinPanel) {\n          api.closePopover()\n          dom(api.button)?.focus() // Re-focus the original opening Button\n        } else {\n          if (api.popoverState.value === PopoverStates.Closed) closeOthers?.(api.buttonId)\n          dom(api.button)?.focus()\n          api.togglePopover()\n        }\n      },\n    }\n  },\n})\n\n// ---\n\nexport let PopoverOverlay = defineComponent({\n  name: 'PopoverOverlay',\n  props: {\n    as: { type: [Object, String], default: 'div' },\n    static: { type: Boolean, default: false },\n    unmount: { type: Boolean, default: true },\n  },\n  render() {\n    let api = usePopoverContext('PopoverOverlay')\n\n    let slot = { open: api.popoverState.value === PopoverStates.Open }\n    let propsWeControl = {\n      id: this.id,\n      ref: 'el',\n      'aria-hidden': true,\n      onClick: this.handleClick,\n    }\n\n    return render({\n      props: { ...this.$props, ...propsWeControl },\n      slot,\n      attrs: this.$attrs,\n      slots: this.$slots,\n      features: Features.RenderStrategy | Features.Static,\n      visible: this.visible,\n      name: 'PopoverOverlay',\n    })\n  },\n  setup() {\n    let api = usePopoverContext('PopoverOverlay')\n\n    let usesOpenClosedState = useOpenClosed()\n    let visible = computed(() => {\n      if (usesOpenClosedState !== null) {\n        return usesOpenClosedState.value === State.Open\n      }\n\n      return api.popoverState.value === PopoverStates.Open\n    })\n\n    return {\n      id: `headlessui-popover-overlay-${useId()}`,\n      handleClick() {\n        api.closePopover()\n      },\n      visible,\n    }\n  },\n})\n\n// ---\n\nexport let PopoverPanel = defineComponent({\n  name: 'PopoverPanel',\n  props: {\n    as: { type: [Object, String], default: 'div' },\n    static: { type: Boolean, default: false },\n    unmount: { type: Boolean, default: true },\n    focus: { type: Boolean, default: false },\n  },\n  render() {\n    let api = usePopoverContext('PopoverPanel')\n\n    let slot = {\n      open: api.popoverState.value === PopoverStates.Open,\n      close: api.close,\n    }\n\n    let propsWeControl = {\n      ref: 'el',\n      id: this.id,\n      onKeydown: this.handleKeyDown,\n    }\n\n    return render({\n      props: { ...this.$props, ...propsWeControl },\n      slot,\n      attrs: this.$attrs,\n      slots: this.$slots,\n      features: Features.RenderStrategy | Features.Static,\n      visible: this.visible,\n      name: 'PopoverPanel',\n    })\n  },\n  setup(props) {\n    let { focus } = props\n    let api = usePopoverContext('PopoverPanel')\n\n    provide(PopoverPanelContext, api.panelId)\n\n    onUnmounted(() => {\n      api.panel.value = null\n    })\n\n    // Move focus within panel\n    watchEffect(() => {\n      if (!focus) return\n      if (api.popoverState.value !== PopoverStates.Open) return\n      if (!api.panel) return\n\n      let activeElement = document.activeElement as HTMLElement\n      if (dom(api.panel)?.contains(activeElement)) return // Already focused within Dialog\n\n      focusIn(dom(api.panel)!, Focus.First)\n    })\n\n    // Handle Tab / Shift+Tab focus positioning\n    useWindowEvent('keydown', (event: KeyboardEvent) => {\n      if (api.popoverState.value !== PopoverStates.Open) return\n      if (!dom(api.panel)) return\n\n      if (event.key !== Keys.Tab) return\n      if (!document.activeElement) return\n      if (!dom(api.panel)?.contains(document.activeElement)) return\n\n      // We will take-over the default tab behaviour so that we have a bit\n      // control over what is focused next. It will behave exactly the same,\n      // but it will also \"fix\" some issues based on whether you are using a\n      // Portal or not.\n      event.preventDefault()\n\n      let result = focusIn(dom(api.panel)!, event.shiftKey ? Focus.Previous : Focus.Next)\n\n      if (result === FocusResult.Underflow) {\n        return dom(api.button)?.focus()\n      } else if (result === FocusResult.Overflow) {\n        if (!dom(api.button)) return\n\n        let elements = getFocusableElements()\n        let buttonIdx = elements.indexOf(dom(api.button)!)\n\n        let nextElements = elements\n          .splice(buttonIdx + 1) // Elements after button\n          .filter(element => !dom(api.panel)?.contains(element)) // Ignore items in panel\n\n        // Try to focus the next element, however it could fail if we are in a\n        // Portal that happens to be the very last one in the DOM. In that\n        // case we would Error (because nothing after the button is\n        // focusable). Therefore we will try and focus the very first item in\n        // the document.body.\n        if (focusIn(nextElements, Focus.First) === FocusResult.Error) {\n          focusIn(document.body, Focus.First)\n        }\n      }\n    })\n\n    // Handle focus out when we are in special \"focus\" mode\n    useWindowEvent(\n      'focus',\n      () => {\n        if (!focus) return\n        if (api.popoverState.value !== PopoverStates.Open) return\n        if (!dom(api.panel)) return\n        if (dom(api.panel)?.contains(document.activeElement as HTMLElement)) return\n        api.closePopover()\n      },\n      true\n    )\n\n    let usesOpenClosedState = useOpenClosed()\n    let visible = computed(() => {\n      if (usesOpenClosedState !== null) {\n        return usesOpenClosedState.value === State.Open\n      }\n\n      return api.popoverState.value === PopoverStates.Open\n    })\n\n    return {\n      id: api.panelId,\n      el: api.panel,\n      handleKeyDown(event: KeyboardEvent) {\n        switch (event.key) {\n          case Keys.Escape:\n            if (api.popoverState.value !== PopoverStates.Open) return\n            if (!dom(api.panel)) return\n            if (!dom(api.panel)?.contains(document.activeElement)) return\n            event.preventDefault()\n            event.stopPropagation()\n            api.closePopover()\n            dom(api.button)?.focus()\n            break\n        }\n      },\n      visible,\n    }\n  },\n})\n\n// ---\n\nexport let PopoverGroup = defineComponent({\n  name: 'PopoverGroup',\n  props: {\n    as: { type: [Object, String], default: 'div' },\n  },\n  render() {\n    let propsWeControl = { ref: 'el' }\n\n    return render({\n      props: { ...this.$props, ...propsWeControl },\n      slot: {},\n      attrs: this.$attrs,\n      slots: this.$slots,\n      name: 'PopoverGroup',\n    })\n  },\n  setup() {\n    let groupRef = ref<HTMLElement | null>(null)\n    let popovers = ref<PopoverRegisterBag[]>([])\n\n    function unregisterPopover(registerBag: PopoverRegisterBag) {\n      let idx = popovers.value.indexOf(registerBag)\n      if (idx !== -1) popovers.value.splice(idx, 1)\n    }\n\n    function registerPopover(registerBag: PopoverRegisterBag) {\n      popovers.value.push(registerBag)\n      return () => {\n        unregisterPopover(registerBag)\n      }\n    }\n\n    function isFocusWithinPopoverGroup() {\n      let element = document.activeElement as HTMLElement\n\n      if (dom(groupRef)?.contains(element)) return true\n\n      // Check if the focus is in one of the button or panel elements. This is important in case you are rendering inside a Portal.\n      return popovers.value.some(bag => {\n        return (\n          document.getElementById(bag.buttonId)?.contains(element) ||\n          document.getElementById(bag.panelId)?.contains(element)\n        )\n      })\n    }\n\n    function closeOthers(buttonId: string) {\n      for (let popover of popovers.value) {\n        if (popover.buttonId !== buttonId) popover.close()\n      }\n    }\n\n    provide(PopoverGroupContext, {\n      registerPopover,\n      unregisterPopover,\n      isFocusWithinPopoverGroup,\n      closeOthers,\n    })\n\n    return { el: groupRef }\n  },\n})\n"],"names":["PopoverStates","PopoverContext","Symbol","usePopoverContext","component","context","inject","err","Error","Popover","name","captureStackTrace","PopoverGroupContext","usePopoverGroupContext","PopoverPanelContext","usePopoverPanelContext","defineComponent","props","as","type","Object","String","setup","slots","attrs","buttonId","useId","panelId","popoverState","ref","Closed","button","panel","api","togglePopover","value","match","Open","closePopover","close","focusableElement","restoreElement","dom","HTMLElement","focus","provide","useOpenClosedProvider","computed","State","registerBag","groupContext","registerPopover","isFocusWithinPopoverGroup","contains","document","activeElement","watchEffect","useWindowEvent","event","target","isFocusableElement","FocusableMode","Loose","preventDefault","slot","open","render","PopoverButton","disabled","Boolean","propsWeControl","isWithinPanel","onKeydown","handleKeyDown","onClick","handleClick","id","$props","undefined","onKeyup","handleKeyUp","$attrs","$slots","closeOthers","panelContext","activeElementRef","previousActiveElementRef","window","elementRef","el","useResolveButtonType","key","Keys","Space","Enter","stopPropagation","Escape","Tab","shiftKey","focusableElements","getFocusableElements","previousIdx","indexOf","buttonIdx","focusIn","Focus","Last","First","PopoverOverlay","unmount","features","Features","RenderStrategy","Static","visible","usesOpenClosedState","useOpenClosed","PopoverPanel","onUnmounted","result","Previous","Next","FocusResult","Underflow","Overflow","elements","nextElements","splice","filter","element","body","PopoverGroup","groupRef","popovers","unregisterPopover","idx","push","some","bag","getElementById","popover"],"mappings":"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"}