{"version":3,"file":"listbox.esm.js","sources":["../../../src/components/listbox/listbox.ts"],"sourcesContent":["import {\n  defineComponent,\n  ref,\n  provide,\n  inject,\n  onMounted,\n  onUnmounted,\n  computed,\n  nextTick,\n  InjectionKey,\n  Ref,\n  ComputedRef,\n  watchEffect,\n  toRaw,\n  watch,\n} from 'vue'\n\nimport { Features, render, omit } from '../../utils/render'\nimport { useId } from '../../hooks/use-id'\nimport { Keys } from '../../keyboard'\nimport { calculateActiveIndex, Focus } from '../../utils/calculate-active-index'\nimport { dom } from '../../utils/dom'\nimport { useWindowEvent } from '../../hooks/use-window-event'\nimport { useOpenClosed, State, useOpenClosedProvider } from '../../internal/open-closed'\nimport { match } from '../../utils/match'\nimport { useResolveButtonType } from '../../hooks/use-resolve-button-type'\n\nenum ListboxStates {\n  Open,\n  Closed,\n}\n\nfunction nextFrame(cb: () => void) {\n  requestAnimationFrame(() => requestAnimationFrame(cb))\n}\n\ntype ListboxOptionDataRef = Ref<{ textValue: string; disabled: boolean; value: unknown }>\ntype StateDefinition = {\n  // State\n  listboxState: Ref<ListboxStates>\n  value: ComputedRef<unknown>\n  orientation: Ref<'vertical' | 'horizontal'>\n\n  labelRef: Ref<HTMLLabelElement | null>\n  buttonRef: Ref<HTMLButtonElement | null>\n  optionsRef: Ref<HTMLDivElement | null>\n\n  disabled: Ref<boolean>\n  options: Ref<{ id: string; dataRef: ListboxOptionDataRef }[]>\n  searchQuery: Ref<string>\n  activeOptionIndex: Ref<number | null>\n\n  // State mutators\n  closeListbox(): void\n  openListbox(): void\n  goToOption(focus: Focus, id?: string): void\n  search(value: string): void\n  clearSearch(): void\n  registerOption(id: string, dataRef: ListboxOptionDataRef): void\n  unregisterOption(id: string): void\n  select(value: unknown): void\n}\n\nlet ListboxContext = Symbol('ListboxContext') as InjectionKey<StateDefinition>\n\nfunction useListboxContext(component: string) {\n  let context = inject(ListboxContext, null)\n\n  if (context === null) {\n    let err = new Error(`<${component} /> is missing a parent <Listbox /> component.`)\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useListboxContext)\n    throw err\n  }\n\n  return context\n}\n\n// ---\n\nexport let Listbox = defineComponent({\n  name: 'Listbox',\n  emits: { 'update:modelValue': (_value: any) => true },\n  props: {\n    as: { type: [Object, String], default: 'template' },\n    disabled: { type: [Boolean], default: false },\n    horizontal: { type: [Boolean], default: false },\n    modelValue: { type: [Object, String, Number, Boolean] },\n  },\n  setup(props, { slots, attrs, emit }) {\n    let listboxState = ref<StateDefinition['listboxState']['value']>(ListboxStates.Closed)\n    let labelRef = ref<StateDefinition['labelRef']['value']>(null)\n    let buttonRef = ref<StateDefinition['buttonRef']['value']>(null)\n    let optionsRef = ref<StateDefinition['optionsRef']['value']>(null)\n    let options = ref<StateDefinition['options']['value']>([])\n    let searchQuery = ref<StateDefinition['searchQuery']['value']>('')\n    let activeOptionIndex = ref<StateDefinition['activeOptionIndex']['value']>(null)\n\n    let value = computed(() => props.modelValue)\n\n    let api = {\n      listboxState,\n      value,\n      orientation: computed(() => (props.horizontal ? 'horizontal' : 'vertical')),\n      labelRef,\n      buttonRef,\n      optionsRef,\n      disabled: computed(() => props.disabled),\n      options,\n      searchQuery,\n      activeOptionIndex,\n      closeListbox() {\n        if (props.disabled) return\n        if (listboxState.value === ListboxStates.Closed) return\n        listboxState.value = ListboxStates.Closed\n        activeOptionIndex.value = null\n      },\n      openListbox() {\n        if (props.disabled) return\n        if (listboxState.value === ListboxStates.Open) return\n        listboxState.value = ListboxStates.Open\n      },\n      goToOption(focus: Focus, id?: string) {\n        if (props.disabled) return\n        if (listboxState.value === ListboxStates.Closed) return\n\n        let nextActiveOptionIndex = calculateActiveIndex(\n          focus === Focus.Specific\n            ? { focus: Focus.Specific, id: id! }\n            : { focus: focus as Exclude<Focus, Focus.Specific> },\n          {\n            resolveItems: () => options.value,\n            resolveActiveIndex: () => activeOptionIndex.value,\n            resolveId: option => option.id,\n            resolveDisabled: option => option.dataRef.disabled,\n          }\n        )\n\n        if (searchQuery.value === '' && activeOptionIndex.value === nextActiveOptionIndex) return\n        searchQuery.value = ''\n        activeOptionIndex.value = nextActiveOptionIndex\n      },\n      search(value: string) {\n        if (props.disabled) return\n        if (listboxState.value === ListboxStates.Closed) return\n\n        searchQuery.value += value.toLowerCase()\n\n        let match = options.value.findIndex(\n          option =>\n            !option.dataRef.disabled && option.dataRef.textValue.startsWith(searchQuery.value)\n        )\n\n        if (match === -1 || match === activeOptionIndex.value) return\n        activeOptionIndex.value = match\n      },\n      clearSearch() {\n        if (props.disabled) return\n        if (listboxState.value === ListboxStates.Closed) return\n        if (searchQuery.value === '') return\n\n        searchQuery.value = ''\n      },\n      registerOption(id: string, dataRef: ListboxOptionDataRef) {\n        // @ts-expect-error The expected type comes from property 'dataRef' which is declared here on type '{ id: string; dataRef: { textValue: string; disabled: boolean; }; }'\n        options.value.push({ id, dataRef })\n      },\n      unregisterOption(id: string) {\n        let nextOptions = options.value.slice()\n        let currentActiveOption =\n          activeOptionIndex.value !== null ? nextOptions[activeOptionIndex.value] : null\n        let idx = nextOptions.findIndex(a => a.id === id)\n        if (idx !== -1) nextOptions.splice(idx, 1)\n        options.value = nextOptions\n        activeOptionIndex.value = (() => {\n          if (idx === activeOptionIndex.value) return null\n          if (currentActiveOption === null) return null\n\n          // If we removed the option before the actual active index, then it would be out of sync. To\n          // fix this, we will find the correct (new) index position.\n          return nextOptions.indexOf(currentActiveOption)\n        })()\n      },\n      select(value: unknown) {\n        if (props.disabled) return\n        emit('update:modelValue', value)\n      },\n    }\n\n    useWindowEvent('mousedown', event => {\n      let target = event.target as HTMLElement\n      let active = document.activeElement\n\n      if (listboxState.value !== ListboxStates.Open) return\n      if (dom(buttonRef)?.contains(target)) return\n\n      if (!dom(optionsRef)?.contains(target)) api.closeListbox()\n      if (active !== document.body && active?.contains(target)) return // Keep focus on newly clicked/focused element\n      if (!event.defaultPrevented) dom(buttonRef)?.focus({ preventScroll: true })\n    })\n\n    // @ts-expect-error Types of property 'dataRef' are incompatible.\n    provide(ListboxContext, api)\n    useOpenClosedProvider(\n      computed(() =>\n        match(listboxState.value, {\n          [ListboxStates.Open]: State.Open,\n          [ListboxStates.Closed]: State.Closed,\n        })\n      )\n    )\n\n    return () => {\n      let slot = { open: listboxState.value === ListboxStates.Open, disabled: props.disabled }\n      return render({\n        props: omit(props, ['modelValue', 'onUpdate:modelValue', 'disabled', 'horizontal']),\n        slot,\n        slots,\n        attrs,\n        name: 'Listbox',\n      })\n    }\n  },\n})\n\n// ---\n\nexport let ListboxLabel = defineComponent({\n  name: 'ListboxLabel',\n  props: { as: { type: [Object, String], default: 'label' } },\n  render() {\n    let api = useListboxContext('ListboxLabel')\n\n    let slot = { open: api.listboxState.value === ListboxStates.Open, disabled: api.disabled.value }\n    let propsWeControl = { id: this.id, ref: 'el', onClick: this.handleClick }\n\n    return render({\n      props: { ...this.$props, ...propsWeControl },\n      slot,\n      attrs: this.$attrs,\n      slots: this.$slots,\n      name: 'ListboxLabel',\n    })\n  },\n  setup() {\n    let api = useListboxContext('ListboxLabel')\n    let id = `headlessui-listbox-label-${useId()}`\n\n    return {\n      id,\n      el: api.labelRef,\n      handleClick() {\n        dom(api.buttonRef)?.focus({ preventScroll: true })\n      },\n    }\n  },\n})\n\n// ---\n\nexport let ListboxButton = defineComponent({\n  name: 'ListboxButton',\n  props: {\n    as: { type: [Object, String], default: 'button' },\n  },\n  render() {\n    let api = useListboxContext('ListboxButton')\n\n    let slot = { open: api.listboxState.value === ListboxStates.Open, disabled: api.disabled.value }\n    let propsWeControl = {\n      ref: 'el',\n      id: this.id,\n      type: this.type,\n      'aria-haspopup': true,\n      'aria-controls': dom(api.optionsRef)?.id,\n      'aria-expanded': api.disabled.value\n        ? undefined\n        : api.listboxState.value === ListboxStates.Open,\n      'aria-labelledby': api.labelRef.value\n        ? [dom(api.labelRef)?.id, this.id].join(' ')\n        : undefined,\n      disabled: api.disabled.value === true ? true : undefined,\n      onKeydown: this.handleKeyDown,\n      onKeyup: this.handleKeyUp,\n      onClick: this.handleClick,\n    }\n\n    return render({\n      props: { ...this.$props, ...propsWeControl },\n      slot,\n      attrs: this.$attrs,\n      slots: this.$slots,\n      name: 'ListboxButton',\n    })\n  },\n  setup(props, { attrs }) {\n    let api = useListboxContext('ListboxButton')\n    let id = `headlessui-listbox-button-${useId()}`\n\n    function handleKeyDown(event: KeyboardEvent) {\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-13\n\n        case Keys.Space:\n        case Keys.Enter:\n        case Keys.ArrowDown:\n          event.preventDefault()\n          api.openListbox()\n          nextTick(() => {\n            dom(api.optionsRef)?.focus({ preventScroll: true })\n            if (!api.value.value) api.goToOption(Focus.First)\n          })\n          break\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          api.openListbox()\n          nextTick(() => {\n            dom(api.optionsRef)?.focus({ preventScroll: true })\n            if (!api.value.value) api.goToOption(Focus.Last)\n          })\n          break\n      }\n    }\n\n    function handleKeyUp(event: KeyboardEvent) {\n      switch (event.key) {\n        case Keys.Space:\n          // Required for firefox, event.preventDefault() in handleKeyDown for\n          // the Space key doesn't cancel the handleKeyUp, which in turn\n          // triggers a *click*.\n          event.preventDefault()\n          break\n      }\n    }\n\n    function handleClick(event: MouseEvent) {\n      if (api.disabled.value) return\n      if (api.listboxState.value === ListboxStates.Open) {\n        api.closeListbox()\n        nextTick(() => dom(api.buttonRef)?.focus({ preventScroll: true }))\n      } else {\n        event.preventDefault()\n        api.openListbox()\n        nextFrame(() => dom(api.optionsRef)?.focus({ preventScroll: true }))\n      }\n    }\n\n    return {\n      id,\n      el: api.buttonRef,\n      type: useResolveButtonType(\n        computed(() => ({ as: props.as, type: attrs.type })),\n        api.buttonRef\n      ),\n      handleKeyDown,\n      handleKeyUp,\n      handleClick,\n    }\n  },\n})\n\n// ---\n\nexport let ListboxOptions = defineComponent({\n  name: 'ListboxOptions',\n  props: {\n    as: { type: [Object, String], default: 'ul' },\n    static: { type: Boolean, default: false },\n    unmount: { type: Boolean, default: true },\n  },\n  render() {\n    let api = useListboxContext('ListboxOptions')\n\n    let slot = { open: api.listboxState.value === ListboxStates.Open }\n    let propsWeControl = {\n      'aria-activedescendant':\n        api.activeOptionIndex.value === null\n          ? undefined\n          : api.options.value[api.activeOptionIndex.value]?.id,\n      'aria-labelledby': dom(api.labelRef)?.id ?? dom(api.buttonRef)?.id,\n      'aria-orientation': api.orientation.value,\n      id: this.id,\n      onKeydown: this.handleKeyDown,\n      role: 'listbox',\n      tabIndex: 0,\n      ref: 'el',\n    }\n    let passThroughProps = this.$props\n\n    return render({\n      props: { ...passThroughProps, ...propsWeControl },\n      slot,\n      attrs: this.$attrs,\n      slots: this.$slots,\n      features: Features.RenderStrategy | Features.Static,\n      visible: this.visible,\n      name: 'ListboxOptions',\n    })\n  },\n  setup() {\n    let api = useListboxContext('ListboxOptions')\n    let id = `headlessui-listbox-options-${useId()}`\n    let searchDebounce = ref<ReturnType<typeof setTimeout> | null>(null)\n\n    function handleKeyDown(event: KeyboardEvent) {\n      if (searchDebounce.value) clearTimeout(searchDebounce.value)\n\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-12\n\n        // @ts-expect-error Fallthrough is expected here\n        case Keys.Space:\n          if (api.searchQuery.value !== '') {\n            event.preventDefault()\n            event.stopPropagation()\n            return api.search(event.key)\n          }\n        // When in type ahead mode, fallthrough\n        case Keys.Enter:\n          event.preventDefault()\n          event.stopPropagation()\n          if (api.activeOptionIndex.value !== null) {\n            let { dataRef } = api.options.value[api.activeOptionIndex.value]\n            api.select(dataRef.value)\n          }\n          api.closeListbox()\n          nextTick(() => dom(api.buttonRef)?.focus({ preventScroll: true }))\n          break\n\n        case match(api.orientation.value, {\n          vertical: Keys.ArrowDown,\n          horizontal: Keys.ArrowRight,\n        }):\n          event.preventDefault()\n          event.stopPropagation()\n          return api.goToOption(Focus.Next)\n\n        case match(api.orientation.value, { vertical: Keys.ArrowUp, horizontal: Keys.ArrowLeft }):\n          event.preventDefault()\n          event.stopPropagation()\n          return api.goToOption(Focus.Previous)\n\n        case Keys.Home:\n        case Keys.PageUp:\n          event.preventDefault()\n          event.stopPropagation()\n          return api.goToOption(Focus.First)\n\n        case Keys.End:\n        case Keys.PageDown:\n          event.preventDefault()\n          event.stopPropagation()\n          return api.goToOption(Focus.Last)\n\n        case Keys.Escape:\n          event.preventDefault()\n          event.stopPropagation()\n          api.closeListbox()\n          nextTick(() => dom(api.buttonRef)?.focus({ preventScroll: true }))\n          break\n\n        case Keys.Tab:\n          event.preventDefault()\n          event.stopPropagation()\n          break\n\n        default:\n          if (event.key.length === 1) {\n            api.search(event.key)\n            searchDebounce.value = setTimeout(() => api.clearSearch(), 350)\n          }\n          break\n      }\n    }\n\n    let usesOpenClosedState = useOpenClosed()\n    let visible = computed(() => {\n      if (usesOpenClosedState !== null) {\n        return usesOpenClosedState.value === State.Open\n      }\n\n      return api.listboxState.value === ListboxStates.Open\n    })\n\n    return { id, el: api.optionsRef, handleKeyDown, visible }\n  },\n})\n\nexport let ListboxOption = defineComponent({\n  name: 'ListboxOption',\n  props: {\n    as: { type: [Object, String], default: 'li' },\n    value: { type: [Object, String, Number, Boolean] },\n    disabled: { type: Boolean, default: false },\n  },\n  setup(props, { slots, attrs }) {\n    let api = useListboxContext('ListboxOption')\n    let id = `headlessui-listbox-option-${useId()}`\n\n    let active = computed(() => {\n      return api.activeOptionIndex.value !== null\n        ? api.options.value[api.activeOptionIndex.value].id === id\n        : false\n    })\n\n    let selected = computed(() => toRaw(api.value.value) === toRaw(props.value))\n\n    let dataRef = ref<ListboxOptionDataRef['value']>({\n      disabled: props.disabled,\n      value: props.value,\n      textValue: '',\n    })\n    onMounted(() => {\n      let textValue = document\n        .getElementById(id)\n        ?.textContent?.toLowerCase()\n        .trim()\n      if (textValue !== undefined) dataRef.value.textValue = textValue\n    })\n\n    onMounted(() => api.registerOption(id, dataRef))\n    onUnmounted(() => api.unregisterOption(id))\n\n    onMounted(() => {\n      watch(\n        [api.listboxState, selected],\n        () => {\n          if (api.listboxState.value !== ListboxStates.Open) return\n          if (!selected.value) return\n          api.goToOption(Focus.Specific, id)\n          document.getElementById(id)?.focus?.()\n        },\n        { immediate: true }\n      )\n    })\n\n    watchEffect(() => {\n      if (api.listboxState.value !== ListboxStates.Open) return\n      if (!active.value) return\n      nextTick(() => document.getElementById(id)?.scrollIntoView?.({ block: 'nearest' }))\n    })\n\n    function handleClick(event: MouseEvent) {\n      if (props.disabled) return event.preventDefault()\n      api.select(props.value)\n      api.closeListbox()\n      nextTick(() => dom(api.buttonRef)?.focus({ preventScroll: true }))\n    }\n\n    function handleFocus() {\n      if (props.disabled) return api.goToOption(Focus.Nothing)\n      api.goToOption(Focus.Specific, id)\n    }\n\n    function handleMove() {\n      if (props.disabled) return\n      if (active.value) return\n      api.goToOption(Focus.Specific, id)\n    }\n\n    function handleLeave() {\n      if (props.disabled) return\n      if (!active.value) return\n      api.goToOption(Focus.Nothing)\n    }\n\n    return () => {\n      let { disabled } = props\n      let slot = { active: active.value, selected: selected.value, disabled }\n      let propsWeControl = {\n        id,\n        role: 'option',\n        tabIndex: disabled === true ? undefined : -1,\n        'aria-disabled': disabled === true ? true : undefined,\n        'aria-selected': selected.value === true ? selected.value : undefined,\n        disabled: undefined, // Never forward the `disabled` prop\n        onClick: handleClick,\n        onFocus: handleFocus,\n        onPointermove: handleMove,\n        onMousemove: handleMove,\n        onPointerleave: handleLeave,\n        onMouseleave: handleLeave,\n      }\n\n      return render({\n        props: { ...props, ...propsWeControl },\n        slot,\n        attrs,\n        slots,\n        name: 'ListboxOption',\n      })\n    }\n  },\n})\n"],"names":["ListboxStates","nextFrame","cb","requestAnimationFrame","ListboxContext","Symbol","useListboxContext","component","context","inject","err","Error","captureStackTrace","Listbox","defineComponent","name","emits","_value","props","as","type","Object","String","disabled","Boolean","horizontal","modelValue","Number","setup","slots","attrs","emit","listboxState","ref","Closed","labelRef","buttonRef","optionsRef","options","searchQuery","activeOptionIndex","value","computed","api","orientation","closeListbox","openListbox","Open","goToOption","focus","id","nextActiveOptionIndex","calculateActiveIndex","Focus","Specific","resolveItems","resolveActiveIndex","resolveId","option","resolveDisabled","dataRef","search","toLowerCase","match","findIndex","textValue","startsWith","clearSearch","registerOption","push","unregisterOption","nextOptions","slice","currentActiveOption","idx","a","splice","indexOf","select","useWindowEvent","event","target","active","document","activeElement","dom","contains","body","defaultPrevented","preventScroll","provide","useOpenClosedProvider","State","slot","open","render","omit","ListboxLabel","propsWeControl","onClick","handleClick","$props","$attrs","$slots","useId","el","ListboxButton","undefined","join","onKeydown","handleKeyDown","onKeyup","handleKeyUp","key","Keys","Space","Enter","ArrowDown","preventDefault","nextTick","First","ArrowUp","Last","useResolveButtonType","ListboxOptions","unmount","role","tabIndex","passThroughProps","features","Features","RenderStrategy","Static","visible","searchDebounce","clearTimeout","stopPropagation","vertical","ArrowRight","Next","ArrowLeft","Previous","Home","PageUp","End","PageDown","Escape","Tab","length","setTimeout","usesOpenClosedState","useOpenClosed","ListboxOption","selected","toRaw","onMounted","getElementById","textContent","trim","onUnmounted","watch","immediate","watchEffect","scrollIntoView","block","handleFocus","Nothing","handleMove","handleLeave","onFocus","onPointermove","onMousemove","onPointerleave","onMouseleave"],"mappings":"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"}